<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Add Questions</title>
</head>
<body>
    <h2>Add Quiz Question</h2>
    <input type="text" id="question" placeholder="Enter question"><br>
    <input type="text" id="option1" placeholder="Option 1"><br>
    <input type="text" id="option2" placeholder="Option 2"><br>
    <input type="text" id="option3" placeholder="Option 3"><br>
    <input type="text" id="option4" placeholder="Option 4"><br>
    
    <label>Correct Answer:</label>
    <select id="correctAnswer">
        <option value="0">Option 1</option>
        <option value="1">Option 2</option>
        <option value="2">Option 3</option>
        <option value="3">Option 4</option>
    </select>
    
    <button id="saveBtn">Save Question</button>

    <script type="module">
        // üîπ Import Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // üîπ Firebase Configuration
        const firebaseConfig = {
             apiKey: "AIzaSyAdvbkZaLSJsJlaAkURHACbt2cJtemBa5U",
             authDomain: "quiz-app-e8d1d.firebaseapp.com",
             projectId: "quiz-app-e8d1d",
             storageBucket: "quiz-app-e8d1d.firebasestorage.app",
             messagingSenderId: "421848385039",
             appId: "1:421848385039:web:cbb560cf9d839752ce457a",
             measurementId: "G-MBCSZVWMZP"
        };

        // üîπ Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        document.getElementById("saveBtn").addEventListener("click", saveQuestion);
        
        async function saveQuestion() {
            console.log("üü¢ saveQuestion() called");

            const questionInput = document.getElementById("question");
            const option1 = document.getElementById("option1");
            const option2 = document.getElementById("option2");
            const option3 = document.getElementById("option3");
            const option4 = document.getElementById("option4");
            const correctAnswerSelect = document.getElementById("correctAnswer");

            const question = questionInput.value.trim();
            const options = [
                option1.value.trim(),
                option2.value.trim(),
                option3.value.trim(),
                option4.value.trim()
            ];
            
            const correctAnswerIndex = parseInt(correctAnswerSelect.value);
            const correctAnswer = options[correctAnswerIndex];

            // üîπ Ensure all fields are filled
            if (!question || options.some(opt => !opt)) {
                alert("‚ö†Ô∏è Please fill in all fields.");
                console.warn("‚ö†Ô∏è Fields are empty. Question not saved.");
                return;
            }

            // üîπ Ensure all options are unique
            const uniqueOptions = new Set(options);
            if (uniqueOptions.size !== options.length) {
                alert("‚ö†Ô∏è Options must be unique.");
                console.warn("‚ö†Ô∏è Duplicate options detected.");
                return;
            }

            try {
                console.log("üü° Checking if question already exists...");

                // üîπ Check if question already exists in Firestore
                const quizCollection = collection(db, "quizQuestions");
                const q = query(quizCollection, where("question", "==", question));
                const querySnapshot = await getDocs(q);

                if (!querySnapshot.empty) {
                    alert("‚ö†Ô∏è Question already exists. Try a different one.");
                    console.warn("‚ö†Ô∏è Duplicate question detected.");
                    return;
                }

                console.log("üü° Adding question to Firebase...");
                await addDoc(quizCollection, { question, options, correctAnswer });
                console.log("‚úÖ Question added successfully!");

                alert("‚úÖ Question Added!");

                // üîπ Reset input fields
                questionInput.value = "";
                option1.value = "";
                option2.value = "";
                option3.value = "";
                option4.value = "";
                correctAnswerSelect.selectedIndex = 0;

                console.log("üü¢ Fields cleared successfully.");
            } catch (error) {
                console.error("‚ùå Error adding question:", error);
            }
        }
    </script>
</body>
</html>
